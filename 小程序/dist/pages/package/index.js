Page({data:{menu:wx.getStorageSync("menu")||[],pageIndex:3,cover:"../../images/default_img.jpg",classTypeId:0,pageTitle:"课程包",classList:!1,startPageX:0,startPageY:0,space:50,showMenu:!1,type:[],animationData:{},showCid:0},onLoad:function(t){let e=this;e.animation=wx.createAnimation({duration:500,timingFunction:"ease"}),wx.showLoading({title:"",success:()=>{e.loadClass(),e.loadClassType()}}),wx.setNavigationBarTitle({title:e.data.pageTitle})},loadClassType:function(){let t=this,e={url:wx.getStorageSync("host")+"/coursePackage/queryCategory",data:{token:wx.getStorageSync("token"),schoolId:wx.getStorageSync("schoolId")},header:{},method:"POST",dataType:"json",success:function(e){if(200===e.statusCode&&!+e.data.flag){let a=e.data.data;a.unshift({id:0,name:"全部学科",pid:0,open:!0,nextLeve:[]}),console.log(a),t.setData({type:a})}},fail:function(){wx.showLoading({icon:"none",title:"加载出错，请重试"})},complete:function(){}};wx.getStorageSync("token")&&wx.getStorageSync("schoolId")?wx.request(e):(wx.showToast({title:"缺少必要参数",icon:"none"}),console.log("获取域名失败"))},loadClass:function(t){let e=this,a={url:wx.getStorageSync("host")+"/coursePackage/queryClassPackage",data:{token:wx.getStorageSync("token"),schoolId:wx.getStorageSync("schoolId")},header:{},method:"POST",dataType:"json",success:function(t){if(wx.hideLoading(),200===t.statusCode&&!+t.data.flag){let a=t.data.data;for(let t in a)a[t].realPrice=a[t].realPrice.toFixed(2),a[t].open=!0;e.setData({classList:a}),wx.setStorageSync("classList",a)}},fail:function(){wx.showLoading({title:"加载出错，请重试"})},complete:function(){e.setData({showtoolbar:!0})}};wx.getStorageSync("token")&&wx.getStorageSync("schoolId")?wx.request(a):(wx.showToast({title:"缺少必要参数",icon:"none"}),console.log("获取域名失败"))},touchStart:function(t){let e=t.changedTouches[0].clientX,a=t.changedTouches[0].clientY,o=0,s=0;switch(t.type){case"touchstart":this.setData({startPageX:e}),this.setData({startPageY:a});break;case"touchend":o=e-this.data.startPageX,s=a-this.data.startPageY,Math.abs(o)>=this.data.space&&Math.abs(s)<this.data.space&&(console.log("ok"),this.animation.left(o>1?110:0).step(),this.setData({animationData:this.animation.export()}))}},getClassInfo:t=>{let e=t.currentTarget.dataset,a=e.id||"",o="/pages/packageContent/index?id="+a;console.log(e),a&&wx.navigateTo({url:o})},changeMenu:function(t){let e=t.target.dataset,a=e.index,o=this.data.type,s=(this.data.classList,this.data.showCid||0),n=this.data.cidIndex||0,i=this.data.showtype||0,c=this.data.ranktype||0,l=this.data.showSid||0,d=!!e.sub,h=!!e.three,g=[],r=[],u={};if(console.log("type[cidIndex]",d,h),d||h||wx.setNavigationBarTitle({title:e.title||"全部分类"}),h)console.log(h,+e.id),console.log("三级分类"),u.threeactive=+e.id;else if(d)l=+e.id,console.log("小类索引",a,n),a>-1&&o[n].nextLeve.length&&o[n].nextLeve[a].nextLeve.length&&(console.log("有第三级"),r=o[n].nextLeve[a].nextLeve,u.three=r),u.subactive=l;else{s=+e.id;for(let t in o)o[t].id==e.id||o[t].id==e.pid?(o[t].open=!0,g=o[t].nextLeve,u.sub=g,u.subactive=0,u.cidIndex=a):o[t].open=!1}console.log(e,s,l,d,i,c,s,n),u.showCid=s,u.showSid=l,u.type=o,u.showmoresub=g.length>7,this.setData(u),this.showResult()},changeSearch:function(){wx.navigateTo({url:"/pages/searchPackage/index"})},showmenu:function(){this.animation.width("100%").step(),this.setData({showMenu:!0,animationData:this.animation.export()})},changeSelectMenu:function(t){let e=t.target.dataset,a=e.type,o={showMenu:!1},s=this.data.type;if(console.log(e,a),"reset"==a){o.showCid=0,o.showSid=0,o.ranktype=0,o.sub=null,o.showmore=s.length>7;for(let t in s)s[t].open=!+t;o.type=s}this.setData(o),this.showResult()},showmoremenus:function(t){let e=t.currentTarget.dataset,a={};console.log(e),a[e.id]=!1,this.setData(a)},selecttype:function(t){let e=t.target.dataset,a=e.type,o=e.id,s=(this.data.showCid,{});console.log(a,o),s[a+"type"]=o,this.setData(s),this.showResult()},showResult:function(){let t=this.data,e=t.showCid||0,a=t.showSid||0,o=t.classtype||0,s=t.ranktype||0,n=["comId","courseNum","realPrice"],i=t.classList;console.log(e,a,o,s);for(let t in i)0==e?i[t].open=!0:i[t].itemOneId==e&&(0==a||i[t].itemSecondId==a)?(i[t].open=!0,i[t].open=!0):i[t].open=!1,i[t].open&&(0==o||"1"==i[t][o]?i[t].open=!0:i[t].open=!1);i.sort(function(t,e){return e[n[s]]-t[n[s]]}),this.setData({classList:i})}});