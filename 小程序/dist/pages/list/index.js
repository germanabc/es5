Page({data:{menu:wx.getStorageSync("menu")||[],pageIndex:1,cover:"../../images/default_img.jpg",classTypeId:0,showtoolbar:!1,pageTitle:"全部课程",classList:!1,startPageX:0,startPageY:0,space:50,showMenu:!1,type:[],animationData:{},showCid:0},onLoad:function(t){let e=this;e.animation=wx.createAnimation({duration:1500,timingFunction:"ease"}),wx.showLoading({title:"",success:()=>{e.loadClass(),e.loadClassType()}}),wx.setNavigationBarTitle({title:e.data.pageTitle})},loadClassType:function(){let t=this,e={url:wx.getStorageSync("host")+"/system/queryConfigItem",data:{token:wx.getStorageSync("token"),schoolId:wx.getStorageSync("schoolId")},header:{},method:"POST",dataType:"json",success:function(e){if(200===e.statusCode&&!+e.data.flag){let a=e.data.data,s=[{id:0,itemName:"全部学科",pid:0,open:!0,pages:[]}],o=[{id:0,itemName:"全部学科",pid:0,open:!0,pages:[]}];for(let t in a)0===a[t].parentId&&(s.push(a[t]),o.push(a[t]));for(let t in o){let e=o[t].id,s=[];for(let t in a)a[t].parentId==e&&0!==e&&s.push(a[t]);o[t].pages=s}console.log(o),t.setData({type:o,showmore:o.length>7})}},fail:function(){wx.showLoading({title:"加载出错，请重试"})},complete:function(){}};wx.getStorageSync("token")&&wx.getStorageSync("schoolId")?wx.request(e):(wx.showToast({title:"缺少必要参数",icon:"none"}),console.log("获取域名失败"))},loadClass:function(t){let e=this,a={url:wx.getStorageSync("host")+"/course/queryCourse",data:{token:wx.getStorageSync("token"),schoolId:wx.getStorageSync("schoolId")},header:{},method:"POST",dataType:"json",success:function(t){if(wx.hideLoading(),200===t.statusCode&&!+t.data.flag){let a=t.data.data,s=["faceFlag","liveFlag","videoFlag","remoteFlag"];for(let t in a){a[t].realPrice=a[t].realPrice.toFixed(2),a[t].originalPrice=a[t].originalPrice.toFixed(2),a[t].open=!0;for(let e in s)if(a[t][s[e]]){a[t].classtype=s[e].replace("Flag","");break}}e.setData({classList:a}),wx.setStorageSync("classList",a)}},fail:function(){wx.showLoading({title:"加载出错，请重试"})},complete:function(){e.setData({showtoolbar:!0})}};wx.getStorageSync("token")&&wx.getStorageSync("schoolId")?wx.request(a):(wx.showToast({title:"缺少必要参数",icon:"none"}),console.log("获取域名失败"))},touchStart:function(t){let e=t.changedTouches[0].clientX,a=t.changedTouches[0].clientY,s=0,o=0;switch(t.type){case"touchstart":this.setData({startPageX:e}),this.setData({startPageY:a});break;case"touchend":s=e-this.data.startPageX,o=a-this.data.startPageY,Math.abs(s)>=this.data.space&&Math.abs(o)<this.data.space&&(console.log("ok"),_this.setData({showMenu:!0}))}},getClassInfo:t=>{let e=t.currentTarget.dataset,a=e.id||"",s="/pages/class/index?id="+a+"&type="+(e.type||"");console.log(e),a&&wx.navigateTo({url:s})},changeMenu:function(t){let e=t.target.dataset,a=this.data.type,s=(this.data.classList,this.data.showCid||0),o=this.data.showtype||0,i=this.data.ranktype||0,n=this.data.showSid||0,l=!!e.sub,c=[],d={};if(l||wx.setNavigationBarTitle({title:e.title||"全部分类"}),l)n=+e.id;else{s=+e.id;for(let t in a)a[t].id==e.id||a[t].id==e.pid?(a[t].open=!0,c=a[t].pages):a[t].open=!1}console.log(e,e.pid,s,n,l,o,i),d={showCid:s,showSid:n,type:a,showmoresub:c.length>7},l?d.subactive=n:(d.sub=c,d.subactive=0),this.setData(d),this.showResult()},changeSearch:function(){wx.navigateTo({url:"/pages/search/index"})},showmenu:function(){this.animation.width("100%").step(),this.setData({showMenu:!0,animationData:this.animation.export()})},changeSelectMenu:function(t){let e=t.target.dataset,a=e.type,s={showMenu:!1},o=this.data.type;if(console.log(e,a),"reset"==a){s.showCid=0,s.showSid=0,s.classtype=0,s.ranktype=0,s.sub=null,s.showmore=o.length>7;for(let t in o)o[t].open=!+t;s.type=o}this.setData(s),this.showResult()},showmoremenus:function(t){let e=t.currentTarget.dataset,a={};console.log(e),a[e.id]=!1,this.setData(a)},selecttype:function(t){let e=t.target.dataset,a=e.type,s=e.id,o=(this.data.showCid,{});console.log(a,s),o[a+"type"]=s,this.setData(o),this.showResult()},showResult:function(){let t=this.data,e=t.showCid||0,a=t.showSid||0,s=t.classtype||0,o=t.ranktype||0,i=["comId","courseNum","realPrice"],n=t.classList;console.log(e,a,s,o);for(let t in n)0==e?n[t].open=!0:n[t].itemOneId==e&&(0==a||n[t].itemSecondId==a)?n[t].open=!0:n[t].open=!1,n[t].open&&(0==s||"1"==n[t][s]?n[t].open=!0:n[t].open=!1);n.sort(function(t,e){return e[i[o]]-t[i[o]]}),this.setData({classList:n})}});