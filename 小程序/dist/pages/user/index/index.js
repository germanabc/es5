Page({data:{menu:[],pageIndex:2,showtoolbar:!0,userId:!1,headPicMax:wx.getStorageSync("headPicMax"),name:wx.getStorageSync("name"),username:wx.getStorageSync("username"),userSign:wx.getStorageSync("userSign"),memberMenu:[[{id:"class",name:"我的课程",target:"class",after:!0},{id:"package",name:"我的课程包",target:"package"}],[{id:"order",name:"我的订单",target:"order"}]]},onLoad:function(e){let t=this;wx.getStorageSync("userId")&&(t.setData({userId:wx.getStorageSync("userId")}),wx.showLoading({title:"",success:function(){t.loadMemberInfo()}})),wx.setNavigationBarTitle({title:"个人中心"})},checkMember:function(e){"user"!==e.target.dataset.id||wx.getStorageSync("userId")||wx.redirectTo({url:"/pages/user/login/index?r=/pages/user/index/index"})},logout:function(){let e=["userId","headPicMax","userSign","name"],t={};for(let a in e)t={[e[a]]:null},wx.setStorageSync(e[a],null),this.setData(t);wx.showToast({title:"退出登录成功",icon:"none"})},loadMemberInfo:function(){let e=this,t={url:wx.getStorageSync("host")+"/user/getCurrentUser",data:{token:wx.getStorageSync("token"),userId:wx.getStorageSync("userId")},method:"POST",dataType:"json",success:function(t){if(wx.hideLoading(),200===t.statusCode){let a=t.data,r=["name","username","stuId","userSign","headPicMax","mobile","vipFlag"];if(!+a.flag)for(let t in r){let n={};wx.setStorageSync(r[t],a.data[r[t]]),n[r[t]]=a.data[r[t]],e.setData(n)}}}};wx.getStorageSync("userId")?wx.request(t):wx.hideLoading()},linkTarget:e=>{let t=e.currentTarget,a=e.target,r=(a.dataset.id?a:t).dataset,n="/pages/user/"+r.target+"/index";console.log(r),wx.getStorageSync("userId")?(console.log("用户已经登录，执行跳转",n),wx.navigateTo({url:n})):(console.log("用户尚未登录"),wx.redirectTo({url:"/pages/user/login/index?r=/pages/user/"+r.target+"/index"}))}});