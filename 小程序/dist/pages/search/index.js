Page({data:{menu:wx.getStorageSync("menu")||[],pageIndex:-1,cover:"../../images/default_img.jpg",pageTitle:"发现课程",history:wx.getStorageSync("history")||[],historyShow:!!wx.getStorageSync("history").length,classList:!1,resultList:!1,searchWord:"",animationData:{}},onLoad:function(t){let e=this;wx.getStorageSync("classList")?(console.log("本地"),e.setData({classList:wx.getStorageSync("classList")})):(console.log("网络"),e.loadClass()),wx.setNavigationBarTitle({title:e.data.pageTitle})},loadClass:function(t){let e=this,a={url:wx.getStorageSync("host")+"/course/queryCourse",data:{token:wx.getStorageSync("token"),schoolId:wx.getStorageSync("schoolId")},header:{},method:"POST",dataType:"json",success:function(t){if(wx.hideLoading(),200===t.statusCode&&!+t.data.flag){let a=t.data.data,o=["faceFlag","liveFlag","videoFlag","remoteFlag"];for(let t in a){a[t].realPrice=a[t].realPrice.toFixed(2),a[t].open=!0;for(let e in o)if(a[t][o[e]]){a[t].classtype=o[e].replace("Flag","");break}}e.setData({classList:a}),e.setData({showMenu:!0})}},fail:function(){wx.showLoading({title:"加载出错，请重试"})},complete:function(){}};wx.getStorageSync("token")&&wx.getStorageSync("schoolId")?wx.request(a):(wx.showToast({title:"缺少必要参数",icon:"none"}),console.log("获取域名失败"))},getClassInfo:t=>{let e=t.currentTarget.dataset,a=e.id||"",o="/pages/class/index?id="+a+"&type="+(e.type||"");console.log(e),a&&wx.navigateTo({url:o})},clearHistory:function(){this.setData({history:[],historyShow:!1})},changeWord:function(t){let e=t.target.dataset.value||t.detail.value;console.log(e),this.setData({searchWord:e,historyShow:!e}),e&&this.getSearch()},getSearch:function(t){let e=this.data.searchWord,a=this.data.classList,o=[];for(let t in a){-1!==a[t].name.indexOf(e)&&o.push(a[t])}this.setData({resultList:o})},addHistory:function(t){let e=t.detail.value,a=this.data.history;console.log(a.indexOf(e)),e&&-1==a.indexOf(e)&&(a.push(e),this.setData({history:a}),wx.setStorageSync("history",a)),console.log("lost focus",e)},backlist:function(){wx.redirectTo({url:"/pages/list/index"})}});